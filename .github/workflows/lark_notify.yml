name: Lark Notify

on:
  issues:
    types: [opened, edited, reopened, closed, deleted]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Notification
        uses: northwang-lucky/chatbot-webhook-client@v1.1.1
        with:
          app: Lark
          webhook: ${{ secrets.LARK_WEBHOOK }}
          template: >-
            {
              "msg_type": "interactive",
              "card": {
                "schema": "2.0",
                "header": {
                  "title": {
                    "tag": "plain_text",
                    "content": "🔔 Issue Update"
                  },
                  "template": "blue"
                },
                "body": {
                  "direction": "vertical",
                  "elements": [
                    {
                      "tag": "div",
                      "text": 
                        {
                          "tag": "lark_md",
                          "content": "**仓库：** ${{ github.event.repository.full_name }}\n**标题:** ${{ github.event.issue.title }}\n**状态：** ${{ github.event.issue.state }}\n**操作：** ${{ github.event.action }}\n**用户：** ${{ github.event.issue.user.login }}\n**触发者：** ${{ github.actor }}\n**时间：** ${{ github.event.issue.updated_at }}\n**内容：** \n "
                        }
                    },
                    {
                      "tag": "div",
                      "text": {
                        "tag": "lark_md",
                        "content": ${{ toJSON(github.event.issue.body) }}
                      }
                    },
                    {
                      "tag": "button",
                      "text": {
                        "tag": "plain_text",
                        "content": "👉 查看详情"
                      },
                      "type": "primary",
                      "behaviors": [
                        {
                          "type": "open_url",
                          "default_url": "${{ github.event.issue.html_url }}"
                        }
                      ]
                    }
                  ]
                }
              }
            }
          github-token: ${{ secrets.GITHUB_TOKEN }}
